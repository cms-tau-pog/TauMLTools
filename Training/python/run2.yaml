period: '2017 (13 TeV)'
sample: 'TT'
vs_type: 'jet'
pt_bins: [20, 100, 1000]

# input 
input_taus: 'eval_data/tau_HTT.h5' # Input file with taus
input_vs_type: 'eval_data/jet_TT.h5' # Input file with non-taus
deep_results: 'eval_data' # Directory with deepId results
read_branches: [ 'tau_pt', 'tau_decayModeFinding', 'tau_decayMode', 'gen_${vs_type}', 'gen_tau', 'tau_charge', 'lepton_gen_charge', 
                  againstElectronMVA6', 'againstMuon3', 'byIsolationMVArun2017v2DBoldDMwLT2017', ]
cuts: ${selection.apply_dm_cuts}
weights: null # Directory with weights to correct the spectrum
prev_deep_results: null # Directory with previous deepId results
output_folder: 'roc_json'
output_name: '${Discriminator.name}_tau_vs_${vs_type}_${sample}_test.json'

selection:
  # # bitwise computation is not supported by pandas.eval() :(
  # apply_legacy_cuts:
  #   e: "(byIsolationMVArun2017v2DBoldDMwLT2017 & (1 << ${wp_name_to_index.VVLoose})) \
  #               and (againstMuon3 & (1 << ${wp_name_to_index.Loose})) \
  #               and (tau_decayMode != 5) & (tau_decayMode != 6)"
  #   mu: "(byIsolationMVArun2017v2DBoldDMwLT2017 & (1 << ${wp_name_to_index.VVLoose})) \
  #               and (againstElectronMVA6 & (1 << ${wp_name_to_index.VLoose})) \
  #               and (tau_decayMode != 5) & (tau_decayMode != 6)"
  #   jet: "(againstElectronMVA6 & (1 << ${wp_name_to_index.VLoose})) \
  #               and (againstMuon3 & (1 << ${wp_name_to_index.Loose})) \
  #               and (tau_decayMode != 5) & (tau_decayMode != 6)"
  apply_deep_cuts:
    e: "(deepId_vs_jet > ${deep_wp_thrs.jet.VVVLoose}) \
          and (deepId_vs_mu > ${deep_wp_thrs.mu.VLoose})"
    mu: "(deepId_vs_e > ${deep_wp_thrs.e.VVVLoose}) \
          and (deepId_vs_jet > ${deep_wp_thrs.jet.VVVLoose})"
    jet: "(deepId_vs_e > ${deep_wp_thrs.e.VVVLoose}) \
          and (deepId_vs_mu > ${deep_wp_thrs.mu.VLoose})"
  apply_dm_cuts: "(tau_decayMode != 5) & (tau_decayMode != 6)"

Discriminator: 
  name: DeepTau
  column: deepId_vs_${vs_type}
  raw: True
  from_tuple: False
  color: blue
  working_points: 
    - ${wp_name_to_index.VVVLoose}
    - ${wp_name_to_index.VVLoose}
    - ${wp_name_to_index.VLoose}
    - ${wp_name_to_index.Loose}
    - ${wp_name_to_index.Medium}
    - ${wp_name_to_index.Tight}
    - ${wp_name_to_index.VTight}
    - ${wp_name_to_index.VVTight}
  working_points_thrs: ${deep_wp_thrs.${vs_type}}

wp_name_to_index:
  VVVLoose: 0
  VVLoose: 1
  VLoose: 2
  Loose: 3
  Medium: 4
  Tight: 5
  VTight: 6
  VVTight: 7
  VVVTight: 8

deep_wp_thrs: # appears in discriminator init and apply selection
  e:
    "VVVLoose": 0.0630386
    "VVLoose": 0.1686942
    "VLoose": 0.3628130
    "Loose": 0.6815435
    "Medium": 0.8847544
    "Tight": 0.9675541
    "VTight": 0.9859251
    "VVTight": 0.9928449
  mu:
    "VLoose": 0.1058354
    "Loose": 0.2158633
    "Medium": 0.5551894
    "Tight": 0.8754835
  jet:
    "VVVLoose": 0.2599605
    "VVLoose": 0.4249705
    "VLoose": 0.5983682
    "Loose": 0.7848675
    "Medium": 0.8834768
    "Tight": 0.9308689
    "VTight": 0.9573137
    "VVTight": 0.9733927

deep_results_label: '' # Label for deepId results
prev_deep_results_label: '' # Label for deepId results
inequality_in_title: False # Use inequality in the title to define pt range, instead of an interval
public_plots: False # Apply public plot styles
apply_legacy_cuts: False
apply_deep_cuts: False
apply_dm_cuts: True

PlotSetup:
  e: 
    ylabel: 'Electron mis-id probability'
    xlim: [0.5, 1]
    ratio_yscale: 'log'
    ylim: [2e-5, 1]
    ratio_ylim: [0.5, 40]
  mu:
    ylabel: 'Muon mis-id probability'
    xlim: [0.98, 1]
    ratio_yscale: 'log'
    ylim: [2e-5, 1]
    ratio_ylim: [ [0.5, 20], [0.5, 20], [0.5, 20], [0.5, 20], [0.5, 20], 
                  [0.5, 20], [0.5, 20], [0.5, 50], [0.5, 50], [0.5, 50] ] 
  jet:
    ylabel: 'Jet mis-id probability'
    ratio_ylabel_pad: 30
    xlim: [0.3, 1]
    # ylim: [ [2e-3, 1], [3e-4, 1], [8e-5, 1], [2e-5, 1], [2e-5, 1],
    #         [5e-6, 1], [5e-6, 1], [5e-6, 1], [5e-6, 1], [2e-6, 1] ]
    ylim: [ [1e-3, 1], [2e-4, 1], [8e-5, 1], [2e-5, 1], [2e-5, 1],
            [5e-6, 1], [5e-6, 1], [5e-6, 1], [5e-6, 1], [2e-6, 1] ]
    ratio_ylim: [ [0.5, 4.5], [0.5, 6.5], [0.5, 2.5], [0.5, 2.5], [0.5, 2.5],
                  [0.5, 3.5], [0.5, 3.5], [0.5, 3.5], [0.5, 10], [0.5, 10] ]
    # ratio_ylim: [ [0.5, 3], [0.5, 5], [0.5, 2.5], [0.5, 2.5], [0.5, 2.5],
    #               [0.5, 3.5], [0.5, 3.5], [0.5, 3.5], [0.5, 10], [0.5, 10] ] 